# Nginx Configuration Fix for Uploads
# Add this to your existing Nginx config for onghoangdohieu.com

# Serve uploaded files directly from Nginx (more efficient)
location /uploads/ {
    alias /home/deploy/theme-editor/theme-editor/public/uploads/;
    
    # Security: only allow image and PDF files
    location ~* \.(jpg|jpeg|png|gif|webp|pdf)$ {
        expires 30d;
        add_header Cache-Control "public, no-transform";
        add_header X-Content-Type-Options "nosniff";
        
        # Optional: Add CORS headers if needed
        add_header Access-Control-Allow-Origin "*";
        add_header Access-Control-Allow-Methods "GET, HEAD";
        add_header Access-Control-Allow-Headers "Accept, Accept-Encoding, Accept-Language, Cache-Control";
    }
    
    # Block access to other file types
    location ~* \.(php|js|html|txt|log|env|git|sql)$ {
        deny all;
        return 404;
    }
    
    # Block access to hidden files
    location ~ /\. {
        deny all;
        return 404;
    }
}

# Alternative: If you want Next.js to handle uploads (less efficient)
# location /uploads/ {
#     proxy_pass http://localhost:3080;
#     proxy_http_version 1.1;
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto $scheme;
# }
